<style>
  mark { color: white }
</style>
<script>
  $(function() {
    $('.blog_content p').each(function() {
      // replace “ and ” with "
      $(this).html($(this).html().replace(/“/g, '"').replace(/”/g, '"'));
      // if the whole paragraph is a quote, convert it into a blockquote
      if ($(this).parent().is('blockquote')) {
        if (!$(this).text().trim().match(/^".*"$/)) {
          $(this).html('"' + $(this).html() + '"');
        }
      } else {
        if ($(this).text().trim().match(/^".*"$/)) {
          $(this).replaceWith('<blockquote><p>' + $(this).html() + '</p></blockquote>')
        } else {
          $(this).html($(this).html().replace(/"([^"]*)"/g, function(match, group) {
            // Check if the quote contains at least 5 words
            if (group.split(' ').length >= 2) {
              return '<mark>"' + group + '"</mark>';
            } else {
              return match;
            }
          }));
        }
      }
    })
  })
</script>

<div class="row">
  <div class="col-lg-2">
    <div class="d-none d-lg-block" id="toc">
    </div>
  </div>
  <div class="col-lg-8">

    <div class="blog_post">
      <h1 class="post-title">
        <a class="text-contrast" href="/posts/<%=@post.id%>">
          <%= @post['Title'] %>
        </a>
      </h1>

      <p class="fira text-muted mb-1">
        <%= date = Date.parse(@post['Created at']); date.strftime("#{date.day.ordinalize} %b %Y") %>
        <span style="position: relative; top: -0.2em" class="badge badge-primary"><%= @post['Generated by AI'] %></span>
      </p>

      <div class="embed-responsive embed-responsive-16by9 mb-4">
        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/<%= @post['Link'].split('=').last %>" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>

      <div class="blog_content">
        <%= md @post['Essay'].split("\n")[1..-1].join("\n") %>
      </div>

    </div>
  </div>
</div>
